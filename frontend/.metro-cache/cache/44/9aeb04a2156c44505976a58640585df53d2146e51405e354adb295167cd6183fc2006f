{"dependencies":[{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":69,"index":69}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"./imageProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":70},"end":{"line":2,"column":52,"index":122}}],"key":"t0qpMRmUECoEeKRprW6P8NJe1qQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.getCachedImage = getCachedImage;\n  exports.primeImages = primeImages;\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[0], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _imageProvider = require(_dependencyMap[1], \"./imageProvider\");\n  const TTL_MS = 48 * 60 * 60 * 1000; // 48 hours\n  const KEY = q => `img:${q.toLowerCase()}`;\n  const META = q => `imgmeta:${q.toLowerCase()}`;\n  async function getCachedImage(query) {\n    try {\n      const k = KEY(query);\n      const m = META(query);\n      const [cached, meta] = await Promise.all([AsyncStorage.default.getItem(k), AsyncStorage.default.getItem(m)]);\n      const now = Date.now();\n      const ts = meta ? Number(meta) : 0;\n      if (cached && ts && now - ts < TTL_MS) return cached;\n      const base64 = await (0, _imageProvider.getBase64ForPlace)(query);\n      if (base64) {\n        await Promise.all([AsyncStorage.default.setItem(k, base64), AsyncStorage.default.setItem(m, String(now))]);\n        return base64;\n      }\n\n      // nothing new; return stale cache if present\n      return cached;\n    } catch {\n      return null;\n    }\n  }\n  async function primeImages(queries) {\n    try {\n      await Promise.all(queries.map(q => getCachedImage(q)));\n    } catch {\n      // ignore\n    }\n  }\n});","lineCount":47,"map":[[12,2,8,0,"exports"],[12,9,8,0],[12,10,8,0,"getCachedImage"],[12,24,8,0],[12,27,8,0,"getCachedImage"],[12,41,8,0],[13,2,31,0,"exports"],[13,9,31,0],[13,10,31,0,"primeImages"],[13,21,31,0],[13,24,31,0,"primeImages"],[13,35,31,0],[14,2,1,0],[14,6,1,0,"_reactNativeAsyncStorageAsyncStorage"],[14,42,1,0],[14,45,1,0,"require"],[14,52,1,0],[14,53,1,0,"_dependencyMap"],[14,67,1,0],[15,2,1,0],[15,6,1,0,"AsyncStorage"],[15,18,1,0],[15,21,1,0,"_interopDefault"],[15,36,1,0],[15,37,1,0,"_reactNativeAsyncStorageAsyncStorage"],[15,73,1,0],[16,2,2,0],[16,6,2,0,"_imageProvider"],[16,20,2,0],[16,23,2,0,"require"],[16,30,2,0],[16,31,2,0,"_dependencyMap"],[16,45,2,0],[17,2,4,0],[17,8,4,6,"TTL_MS"],[17,14,4,12],[17,17,4,15],[17,19,4,17],[17,22,4,20],[17,24,4,22],[17,27,4,25],[17,29,4,27],[17,32,4,30],[17,36,4,34],[17,37,4,35],[17,38,4,36],[18,2,5,0],[18,8,5,6,"KEY"],[18,11,5,9],[18,14,5,13,"q"],[18,15,5,22],[18,19,5,27],[18,26,5,34,"q"],[18,27,5,35],[18,28,5,36,"toLowerCase"],[18,39,5,47],[18,40,5,48],[18,41,5,49],[18,43,5,51],[19,2,6,0],[19,8,6,6,"META"],[19,12,6,10],[19,15,6,14,"q"],[19,16,6,23],[19,20,6,28],[19,31,6,39,"q"],[19,32,6,40],[19,33,6,41,"toLowerCase"],[19,44,6,52],[19,45,6,53],[19,46,6,54],[19,48,6,56],[20,2,8,7],[20,17,8,22,"getCachedImage"],[20,31,8,36,"getCachedImage"],[20,32,8,37,"query"],[20,37,8,50],[20,39,8,76],[21,4,9,2],[21,8,9,6],[22,6,10,4],[22,12,10,10,"k"],[22,13,10,11],[22,16,10,14,"KEY"],[22,19,10,17],[22,20,10,18,"query"],[22,25,10,23],[22,26,10,24],[23,6,11,4],[23,12,11,10,"m"],[23,13,11,11],[23,16,11,14,"META"],[23,20,11,18],[23,21,11,19,"query"],[23,26,11,24],[23,27,11,25],[24,6,12,4],[24,12,12,10],[24,13,12,11,"cached"],[24,19,12,17],[24,21,12,19,"meta"],[24,25,12,23],[24,26,12,24],[24,29,12,27],[24,35,12,33,"Promise"],[24,42,12,40],[24,43,12,41,"all"],[24,46,12,44],[24,47,12,45],[24,48,12,46,"AsyncStorage"],[24,60,12,58],[24,61,12,58,"default"],[24,68,12,58],[24,69,12,59,"getItem"],[24,76,12,66],[24,77,12,67,"k"],[24,78,12,68],[24,79,12,69],[24,81,12,71,"AsyncStorage"],[24,93,12,83],[24,94,12,83,"default"],[24,101,12,83],[24,102,12,84,"getItem"],[24,109,12,91],[24,110,12,92,"m"],[24,111,12,93],[24,112,12,94],[24,113,12,95],[24,114,12,96],[25,6,13,4],[25,12,13,10,"now"],[25,15,13,13],[25,18,13,16,"Date"],[25,22,13,20],[25,23,13,21,"now"],[25,26,13,24],[25,27,13,25],[25,28,13,26],[26,6,14,4],[26,12,14,10,"ts"],[26,14,14,12],[26,17,14,15,"meta"],[26,21,14,19],[26,24,14,22,"Number"],[26,30,14,28],[26,31,14,29,"meta"],[26,35,14,33],[26,36,14,34],[26,39,14,37],[26,40,14,38],[27,6,16,4],[27,10,16,8,"cached"],[27,16,16,14],[27,20,16,18,"ts"],[27,22,16,20],[27,26,16,24,"now"],[27,29,16,27],[27,32,16,30,"ts"],[27,34,16,32],[27,37,16,35,"TTL_MS"],[27,43,16,41],[27,45,16,43],[27,52,16,50,"cached"],[27,58,16,56],[28,6,18,4],[28,12,18,10,"base64"],[28,18,18,16],[28,21,18,19],[28,27,18,25],[28,31,18,25,"getBase64ForPlace"],[28,45,18,42],[28,46,18,42,"getBase64ForPlace"],[28,63,18,42],[28,65,18,43,"query"],[28,70,18,48],[28,71,18,49],[29,6,19,4],[29,10,19,8,"base64"],[29,16,19,14],[29,18,19,16],[30,8,20,6],[30,14,20,12,"Promise"],[30,21,20,19],[30,22,20,20,"all"],[30,25,20,23],[30,26,20,24],[30,27,20,25,"AsyncStorage"],[30,39,20,37],[30,40,20,37,"default"],[30,47,20,37],[30,48,20,38,"setItem"],[30,55,20,45],[30,56,20,46,"k"],[30,57,20,47],[30,59,20,49,"base64"],[30,65,20,55],[30,66,20,56],[30,68,20,58,"AsyncStorage"],[30,80,20,70],[30,81,20,70,"default"],[30,88,20,70],[30,89,20,71,"setItem"],[30,96,20,78],[30,97,20,79,"m"],[30,98,20,80],[30,100,20,82,"String"],[30,106,20,88],[30,107,20,89,"now"],[30,110,20,92],[30,111,20,93],[30,112,20,94],[30,113,20,95],[30,114,20,96],[31,8,21,6],[31,15,21,13,"base64"],[31,21,21,19],[32,6,22,4],[34,6,24,4],[35,6,25,4],[35,13,25,11,"cached"],[35,19,25,17],[36,4,26,2],[36,5,26,3],[36,6,26,4],[36,12,26,10],[37,6,27,4],[37,13,27,11],[37,17,27,15],[38,4,28,2],[39,2,29,0],[40,2,31,7],[40,17,31,22,"primeImages"],[40,28,31,33,"primeImages"],[40,29,31,34,"queries"],[40,36,31,51],[40,38,31,53],[41,4,32,2],[41,8,32,6],[42,6,33,4],[42,12,33,10,"Promise"],[42,19,33,17],[42,20,33,18,"all"],[42,23,33,21],[42,24,33,22,"queries"],[42,31,33,29],[42,32,33,30,"map"],[42,35,33,33],[42,36,33,35,"q"],[42,37,33,36],[42,41,33,41,"getCachedImage"],[42,55,33,55],[42,56,33,56,"q"],[42,57,33,57],[42,58,33,58],[42,59,33,59],[42,60,33,60],[43,4,34,2],[43,5,34,3],[43,6,34,4],[43,12,34,10],[44,6,35,4],[45,4,35,4],[46,2,37,0],[47,0,37,1],[47,3]],"functionMap":{"names":["<global>","KEY","META","getCachedImage","primeImages","queries.map$argument_0"],"mappings":"AAA;YCI,uCD;aEC,2CF;OGE;CHqB;OIE;kCCE,wBD"},"hasCjsExports":false},"type":"js/module"}]}