{"dependencies":[{"name":"@babel/runtime/helpers/slicedToArray","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"5y7e5+zC7teYEEC6niD9f5zII1M=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":69,"index":69}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"./imageProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":70},"end":{"line":2,"column":52,"index":122}}],"key":"t0qpMRmUECoEeKRprW6P8NJe1qQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.getCachedImage = getCachedImage;\n  exports.primeImages = primeImages;\n  var _babelRuntimeHelpersSlicedToArray = require(_dependencyMap[0], \"@babel/runtime/helpers/slicedToArray\");\n  var _slicedToArray = _interopDefault(_babelRuntimeHelpersSlicedToArray);\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[1], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[2], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _imageProvider = require(_dependencyMap[3], \"./imageProvider\");\n  var TTL_MS = 48 * 60 * 60 * 1000; // 48 hours\n  var KEY = q => `img:${q.toLowerCase()}`;\n  _c = KEY;\n  var META = q => `imgmeta:${q.toLowerCase()}`;\n  _c2 = META;\n  function getCachedImage(_x) {\n    return _getCachedImage.apply(this, arguments);\n  }\n  function _getCachedImage() {\n    _getCachedImage = (0, _asyncToGenerator.default)(function* (query) {\n      try {\n        var k = KEY(query);\n        var m = META(query);\n        var _yield$Promise$all = yield Promise.all([AsyncStorage.default.getItem(k), AsyncStorage.default.getItem(m)]),\n          _yield$Promise$all2 = (0, _slicedToArray.default)(_yield$Promise$all, 2),\n          cached = _yield$Promise$all2[0],\n          meta = _yield$Promise$all2[1];\n        var now = Date.now();\n        var ts = meta ? Number(meta) : 0;\n        if (cached && ts && now - ts < TTL_MS) return cached;\n        var base64 = yield (0, _imageProvider.getBase64ForPlace)(query);\n        if (base64) {\n          yield Promise.all([AsyncStorage.default.setItem(k, base64), AsyncStorage.default.setItem(m, String(now))]);\n          return base64;\n        }\n\n        // nothing new; return stale cache if present\n        return cached;\n      } catch {\n        return null;\n      }\n    });\n    return _getCachedImage.apply(this, arguments);\n  }\n  function primeImages(_x2) {\n    return _primeImages.apply(this, arguments);\n  }\n  function _primeImages() {\n    _primeImages = (0, _asyncToGenerator.default)(function* (queries) {\n      try {\n        yield Promise.all(queries.map(q => getCachedImage(q)));\n      } catch {\n        // ignore\n      }\n    });\n    return _primeImages.apply(this, arguments);\n  }\n  var _c, _c2;\n  $RefreshReg$(_c, \"KEY\");\n  $RefreshReg$(_c2, \"META\");\n});","lineCount":71,"map":[[12,2,8,0,"exports"],[12,9,8,0],[12,10,8,0,"getCachedImage"],[12,24,8,0],[12,27,8,0,"getCachedImage"],[12,41,8,0],[13,2,31,0,"exports"],[13,9,31,0],[13,10,31,0,"primeImages"],[13,21,31,0],[13,24,31,0,"primeImages"],[13,35,31,0],[14,2,37,1],[14,6,37,1,"_babelRuntimeHelpersSlicedToArray"],[14,39,37,1],[14,42,37,1,"require"],[14,49,37,1],[14,50,37,1,"_dependencyMap"],[14,64,37,1],[15,2,37,1],[15,6,37,1,"_slicedToArray"],[15,20,37,1],[15,23,37,1,"_interopDefault"],[15,38,37,1],[15,39,37,1,"_babelRuntimeHelpersSlicedToArray"],[15,72,37,1],[16,2,37,1],[16,6,37,1,"_babelRuntimeHelpersAsyncToGenerator"],[16,42,37,1],[16,45,37,1,"require"],[16,52,37,1],[16,53,37,1,"_dependencyMap"],[16,67,37,1],[17,2,37,1],[17,6,37,1,"_asyncToGenerator"],[17,23,37,1],[17,26,37,1,"_interopDefault"],[17,41,37,1],[17,42,37,1,"_babelRuntimeHelpersAsyncToGenerator"],[17,78,37,1],[18,2,1,0],[18,6,1,0,"_reactNativeAsyncStorageAsyncStorage"],[18,42,1,0],[18,45,1,0,"require"],[18,52,1,0],[18,53,1,0,"_dependencyMap"],[18,67,1,0],[19,2,1,0],[19,6,1,0,"AsyncStorage"],[19,18,1,0],[19,21,1,0,"_interopDefault"],[19,36,1,0],[19,37,1,0,"_reactNativeAsyncStorageAsyncStorage"],[19,73,1,0],[20,2,2,0],[20,6,2,0,"_imageProvider"],[20,20,2,0],[20,23,2,0,"require"],[20,30,2,0],[20,31,2,0,"_dependencyMap"],[20,45,2,0],[21,2,4,0],[21,6,4,6,"TTL_MS"],[21,12,4,12],[21,15,4,15],[21,17,4,17],[21,20,4,20],[21,22,4,22],[21,25,4,25],[21,27,4,27],[21,30,4,30],[21,34,4,34],[21,35,4,35],[21,36,4,36],[22,2,5,0],[22,6,5,6,"KEY"],[22,9,5,9],[22,12,5,13,"q"],[22,13,5,22],[22,17,5,27],[22,24,5,34,"q"],[22,25,5,35],[22,26,5,36,"toLowerCase"],[22,37,5,47],[22,38,5,48],[22,39,5,49],[22,41,5,51],[23,2,5,52,"_c"],[23,4,5,52],[23,7,5,6,"KEY"],[23,10,5,9],[24,2,6,0],[24,6,6,6,"META"],[24,10,6,10],[24,13,6,14,"q"],[24,14,6,23],[24,18,6,28],[24,29,6,39,"q"],[24,30,6,40],[24,31,6,41,"toLowerCase"],[24,42,6,52],[24,43,6,53],[24,44,6,54],[24,46,6,56],[25,2,6,57,"_c2"],[25,5,6,57],[25,8,6,6,"META"],[25,12,6,10],[26,2,6,10],[26,11,8,22,"getCachedImage"],[26,25,8,36,"getCachedImage"],[26,26,8,36,"_x"],[26,28,8,36],[27,4,8,36],[27,11,8,36,"_getCachedImage"],[27,26,8,36],[27,27,8,36,"apply"],[27,32,8,36],[27,39,8,36,"arguments"],[27,48,8,36],[28,2,8,36],[29,2,8,36],[29,11,8,36,"_getCachedImage"],[29,27,8,36],[30,4,8,36,"_getCachedImage"],[30,19,8,36],[30,26,8,36,"_asyncToGenerator"],[30,43,8,36],[30,44,8,36,"default"],[30,51,8,36],[30,53,8,7],[30,64,8,37,"query"],[30,69,8,50],[30,71,8,76],[31,6,9,2],[31,10,9,6],[32,8,10,4],[32,12,10,10,"k"],[32,13,10,11],[32,16,10,14,"KEY"],[32,19,10,17],[32,20,10,18,"query"],[32,25,10,23],[32,26,10,24],[33,8,11,4],[33,12,11,10,"m"],[33,13,11,11],[33,16,11,14,"META"],[33,20,11,18],[33,21,11,19,"query"],[33,26,11,24],[33,27,11,25],[34,8,12,4],[34,12,12,4,"_yield$Promise$all"],[34,30,12,4],[34,39,12,33,"Promise"],[34,46,12,40],[34,47,12,41,"all"],[34,50,12,44],[34,51,12,45],[34,52,12,46,"AsyncStorage"],[34,64,12,58],[34,65,12,58,"default"],[34,72,12,58],[34,73,12,59,"getItem"],[34,80,12,66],[34,81,12,67,"k"],[34,82,12,68],[34,83,12,69],[34,85,12,71,"AsyncStorage"],[34,97,12,83],[34,98,12,83,"default"],[34,105,12,83],[34,106,12,84,"getItem"],[34,113,12,91],[34,114,12,92,"m"],[34,115,12,93],[34,116,12,94],[34,117,12,95],[34,118,12,96],[35,10,12,96,"_yield$Promise$all2"],[35,29,12,96],[35,36,12,96,"_slicedToArray"],[35,50,12,96],[35,51,12,96,"default"],[35,58,12,96],[35,60,12,96,"_yield$Promise$all"],[35,78,12,96],[36,10,12,11,"cached"],[36,16,12,17],[36,19,12,17,"_yield$Promise$all2"],[36,38,12,17],[37,10,12,19,"meta"],[37,14,12,23],[37,17,12,23,"_yield$Promise$all2"],[37,36,12,23],[38,8,13,4],[38,12,13,10,"now"],[38,15,13,13],[38,18,13,16,"Date"],[38,22,13,20],[38,23,13,21,"now"],[38,26,13,24],[38,27,13,25],[38,28,13,26],[39,8,14,4],[39,12,14,10,"ts"],[39,14,14,12],[39,17,14,15,"meta"],[39,21,14,19],[39,24,14,22,"Number"],[39,30,14,28],[39,31,14,29,"meta"],[39,35,14,33],[39,36,14,34],[39,39,14,37],[39,40,14,38],[40,8,16,4],[40,12,16,8,"cached"],[40,18,16,14],[40,22,16,18,"ts"],[40,24,16,20],[40,28,16,24,"now"],[40,31,16,27],[40,34,16,30,"ts"],[40,36,16,32],[40,39,16,35,"TTL_MS"],[40,45,16,41],[40,47,16,43],[40,54,16,50,"cached"],[40,60,16,56],[41,8,18,4],[41,12,18,10,"base64"],[41,18,18,16],[41,27,18,25],[41,31,18,25,"getBase64ForPlace"],[41,45,18,42],[41,46,18,42,"getBase64ForPlace"],[41,63,18,42],[41,65,18,43,"query"],[41,70,18,48],[41,71,18,49],[42,8,19,4],[42,12,19,8,"base64"],[42,18,19,14],[42,20,19,16],[43,10,20,6],[43,16,20,12,"Promise"],[43,23,20,19],[43,24,20,20,"all"],[43,27,20,23],[43,28,20,24],[43,29,20,25,"AsyncStorage"],[43,41,20,37],[43,42,20,37,"default"],[43,49,20,37],[43,50,20,38,"setItem"],[43,57,20,45],[43,58,20,46,"k"],[43,59,20,47],[43,61,20,49,"base64"],[43,67,20,55],[43,68,20,56],[43,70,20,58,"AsyncStorage"],[43,82,20,70],[43,83,20,70,"default"],[43,90,20,70],[43,91,20,71,"setItem"],[43,98,20,78],[43,99,20,79,"m"],[43,100,20,80],[43,102,20,82,"String"],[43,108,20,88],[43,109,20,89,"now"],[43,112,20,92],[43,113,20,93],[43,114,20,94],[43,115,20,95],[43,116,20,96],[44,10,21,6],[44,17,21,13,"base64"],[44,23,21,19],[45,8,22,4],[47,8,24,4],[48,8,25,4],[48,15,25,11,"cached"],[48,21,25,17],[49,6,26,2],[49,7,26,3],[49,8,26,4],[49,14,26,10],[50,8,27,4],[50,15,27,11],[50,19,27,15],[51,6,28,2],[52,4,29,0],[52,5,29,1],[53,4,29,1],[53,11,29,1,"_getCachedImage"],[53,26,29,1],[53,27,29,1,"apply"],[53,32,29,1],[53,39,29,1,"arguments"],[53,48,29,1],[54,2,29,1],[55,2,29,1],[55,11,31,22,"primeImages"],[55,22,31,33,"primeImages"],[55,23,31,33,"_x2"],[55,26,31,33],[56,4,31,33],[56,11,31,33,"_primeImages"],[56,23,31,33],[56,24,31,33,"apply"],[56,29,31,33],[56,36,31,33,"arguments"],[56,45,31,33],[57,2,31,33],[58,2,31,33],[58,11,31,33,"_primeImages"],[58,24,31,33],[59,4,31,33,"_primeImages"],[59,16,31,33],[59,23,31,33,"_asyncToGenerator"],[59,40,31,33],[59,41,31,33,"default"],[59,48,31,33],[59,50,31,7],[59,61,31,34,"queries"],[59,68,31,51],[59,70,31,53],[60,6,32,2],[60,10,32,6],[61,8,33,4],[61,14,33,10,"Promise"],[61,21,33,17],[61,22,33,18,"all"],[61,25,33,21],[61,26,33,22,"queries"],[61,33,33,29],[61,34,33,30,"map"],[61,37,33,33],[61,38,33,35,"q"],[61,39,33,36],[61,43,33,41,"getCachedImage"],[61,57,33,55],[61,58,33,56,"q"],[61,59,33,57],[61,60,33,58],[61,61,33,59],[61,62,33,60],[62,6,34,2],[62,7,34,3],[62,8,34,4],[62,14,34,10],[63,8,35,4],[64,6,35,4],[65,4,37,0],[65,5,37,1],[66,4,37,1],[66,11,37,1,"_primeImages"],[66,23,37,1],[66,24,37,1,"apply"],[66,29,37,1],[66,36,37,1,"arguments"],[66,45,37,1],[67,2,37,1],[68,2,37,1],[68,6,37,1,"_c"],[68,8,37,1],[68,10,37,1,"_c2"],[68,13,37,1],[69,2,37,1,"$RefreshReg$"],[69,14,37,1],[69,15,37,1,"_c"],[69,17,37,1],[70,2,37,1,"$RefreshReg$"],[70,14,37,1],[70,15,37,1,"_c2"],[70,18,37,1],[71,0,37,1],[71,3]],"functionMap":{"names":["<global>","KEY","META","getCachedImage","primeImages","queries.map$argument_0"],"mappings":"AAA;YCI,uCD;aEC,2CF;OGE;CHqB;OIE;kCCE,wBD"},"hasCjsExports":false},"type":"js/module"}]}