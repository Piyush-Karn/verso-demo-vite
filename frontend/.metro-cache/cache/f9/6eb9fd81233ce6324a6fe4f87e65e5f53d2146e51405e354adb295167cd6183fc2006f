{"dependencies":[{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":69,"index":69}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"./imageProvider","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":70},"end":{"line":2,"column":52,"index":122}}],"key":"t0qpMRmUECoEeKRprW6P8NJe1qQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.getCachedImage = getCachedImage;\n  exports.primeImages = primeImages;\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[0], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _imageProvider = require(_dependencyMap[1], \"./imageProvider\");\n  const TTL_MS = 48 * 60 * 60 * 1000; // 48 hours\n  const KEY = q => `img:${q.toLowerCase()}`;\n  _c = KEY;\n  const META = q => `imgmeta:${q.toLowerCase()}`;\n  _c2 = META;\n  async function getCachedImage(query) {\n    try {\n      const k = KEY(query);\n      const m = META(query);\n      const [cached, meta] = await Promise.all([AsyncStorage.default.getItem(k), AsyncStorage.default.getItem(m)]);\n      const now = Date.now();\n      const ts = meta ? Number(meta) : 0;\n      if (cached && ts && now - ts < TTL_MS) return cached;\n      const base64 = await (0, _imageProvider.getBase64ForPlace)(query);\n      if (base64) {\n        await Promise.all([AsyncStorage.default.setItem(k, base64), AsyncStorage.default.setItem(m, String(now))]);\n        return base64;\n      }\n\n      // nothing new; return stale cache if present\n      return cached;\n    } catch {\n      return null;\n    }\n  }\n  async function primeImages(queries) {\n    try {\n      await Promise.all(queries.map(q => getCachedImage(q)));\n    } catch {\n      // ignore\n    }\n  }\n  var _c, _c2;\n  $RefreshReg$(_c, \"KEY\");\n  $RefreshReg$(_c2, \"META\");\n});","lineCount":52,"map":[[12,2,8,0,"exports"],[12,9,8,0],[12,10,8,0,"getCachedImage"],[12,24,8,0],[12,27,8,0,"getCachedImage"],[12,41,8,0],[13,2,31,0,"exports"],[13,9,31,0],[13,10,31,0,"primeImages"],[13,21,31,0],[13,24,31,0,"primeImages"],[13,35,31,0],[14,2,1,0],[14,6,1,0,"_reactNativeAsyncStorageAsyncStorage"],[14,42,1,0],[14,45,1,0,"require"],[14,52,1,0],[14,53,1,0,"_dependencyMap"],[14,67,1,0],[15,2,1,0],[15,6,1,0,"AsyncStorage"],[15,18,1,0],[15,21,1,0,"_interopDefault"],[15,36,1,0],[15,37,1,0,"_reactNativeAsyncStorageAsyncStorage"],[15,73,1,0],[16,2,2,0],[16,6,2,0,"_imageProvider"],[16,20,2,0],[16,23,2,0,"require"],[16,30,2,0],[16,31,2,0,"_dependencyMap"],[16,45,2,0],[17,2,4,0],[17,8,4,6,"TTL_MS"],[17,14,4,12],[17,17,4,15],[17,19,4,17],[17,22,4,20],[17,24,4,22],[17,27,4,25],[17,29,4,27],[17,32,4,30],[17,36,4,34],[17,37,4,35],[17,38,4,36],[18,2,5,0],[18,8,5,6,"KEY"],[18,11,5,9],[18,14,5,13,"q"],[18,15,5,22],[18,19,5,27],[18,26,5,34,"q"],[18,27,5,35],[18,28,5,36,"toLowerCase"],[18,39,5,47],[18,40,5,48],[18,41,5,49],[18,43,5,51],[19,2,5,52,"_c"],[19,4,5,52],[19,7,5,6,"KEY"],[19,10,5,9],[20,2,6,0],[20,8,6,6,"META"],[20,12,6,10],[20,15,6,14,"q"],[20,16,6,23],[20,20,6,28],[20,31,6,39,"q"],[20,32,6,40],[20,33,6,41,"toLowerCase"],[20,44,6,52],[20,45,6,53],[20,46,6,54],[20,48,6,56],[21,2,6,57,"_c2"],[21,5,6,57],[21,8,6,6,"META"],[21,12,6,10],[22,2,8,7],[22,17,8,22,"getCachedImage"],[22,31,8,36,"getCachedImage"],[22,32,8,37,"query"],[22,37,8,50],[22,39,8,76],[23,4,9,2],[23,8,9,6],[24,6,10,4],[24,12,10,10,"k"],[24,13,10,11],[24,16,10,14,"KEY"],[24,19,10,17],[24,20,10,18,"query"],[24,25,10,23],[24,26,10,24],[25,6,11,4],[25,12,11,10,"m"],[25,13,11,11],[25,16,11,14,"META"],[25,20,11,18],[25,21,11,19,"query"],[25,26,11,24],[25,27,11,25],[26,6,12,4],[26,12,12,10],[26,13,12,11,"cached"],[26,19,12,17],[26,21,12,19,"meta"],[26,25,12,23],[26,26,12,24],[26,29,12,27],[26,35,12,33,"Promise"],[26,42,12,40],[26,43,12,41,"all"],[26,46,12,44],[26,47,12,45],[26,48,12,46,"AsyncStorage"],[26,60,12,58],[26,61,12,58,"default"],[26,68,12,58],[26,69,12,59,"getItem"],[26,76,12,66],[26,77,12,67,"k"],[26,78,12,68],[26,79,12,69],[26,81,12,71,"AsyncStorage"],[26,93,12,83],[26,94,12,83,"default"],[26,101,12,83],[26,102,12,84,"getItem"],[26,109,12,91],[26,110,12,92,"m"],[26,111,12,93],[26,112,12,94],[26,113,12,95],[26,114,12,96],[27,6,13,4],[27,12,13,10,"now"],[27,15,13,13],[27,18,13,16,"Date"],[27,22,13,20],[27,23,13,21,"now"],[27,26,13,24],[27,27,13,25],[27,28,13,26],[28,6,14,4],[28,12,14,10,"ts"],[28,14,14,12],[28,17,14,15,"meta"],[28,21,14,19],[28,24,14,22,"Number"],[28,30,14,28],[28,31,14,29,"meta"],[28,35,14,33],[28,36,14,34],[28,39,14,37],[28,40,14,38],[29,6,16,4],[29,10,16,8,"cached"],[29,16,16,14],[29,20,16,18,"ts"],[29,22,16,20],[29,26,16,24,"now"],[29,29,16,27],[29,32,16,30,"ts"],[29,34,16,32],[29,37,16,35,"TTL_MS"],[29,43,16,41],[29,45,16,43],[29,52,16,50,"cached"],[29,58,16,56],[30,6,18,4],[30,12,18,10,"base64"],[30,18,18,16],[30,21,18,19],[30,27,18,25],[30,31,18,25,"getBase64ForPlace"],[30,45,18,42],[30,46,18,42,"getBase64ForPlace"],[30,63,18,42],[30,65,18,43,"query"],[30,70,18,48],[30,71,18,49],[31,6,19,4],[31,10,19,8,"base64"],[31,16,19,14],[31,18,19,16],[32,8,20,6],[32,14,20,12,"Promise"],[32,21,20,19],[32,22,20,20,"all"],[32,25,20,23],[32,26,20,24],[32,27,20,25,"AsyncStorage"],[32,39,20,37],[32,40,20,37,"default"],[32,47,20,37],[32,48,20,38,"setItem"],[32,55,20,45],[32,56,20,46,"k"],[32,57,20,47],[32,59,20,49,"base64"],[32,65,20,55],[32,66,20,56],[32,68,20,58,"AsyncStorage"],[32,80,20,70],[32,81,20,70,"default"],[32,88,20,70],[32,89,20,71,"setItem"],[32,96,20,78],[32,97,20,79,"m"],[32,98,20,80],[32,100,20,82,"String"],[32,106,20,88],[32,107,20,89,"now"],[32,110,20,92],[32,111,20,93],[32,112,20,94],[32,113,20,95],[32,114,20,96],[33,8,21,6],[33,15,21,13,"base64"],[33,21,21,19],[34,6,22,4],[36,6,24,4],[37,6,25,4],[37,13,25,11,"cached"],[37,19,25,17],[38,4,26,2],[38,5,26,3],[38,6,26,4],[38,12,26,10],[39,6,27,4],[39,13,27,11],[39,17,27,15],[40,4,28,2],[41,2,29,0],[42,2,31,7],[42,17,31,22,"primeImages"],[42,28,31,33,"primeImages"],[42,29,31,34,"queries"],[42,36,31,51],[42,38,31,53],[43,4,32,2],[43,8,32,6],[44,6,33,4],[44,12,33,10,"Promise"],[44,19,33,17],[44,20,33,18,"all"],[44,23,33,21],[44,24,33,22,"queries"],[44,31,33,29],[44,32,33,30,"map"],[44,35,33,33],[44,36,33,35,"q"],[44,37,33,36],[44,41,33,41,"getCachedImage"],[44,55,33,55],[44,56,33,56,"q"],[44,57,33,57],[44,58,33,58],[44,59,33,59],[44,60,33,60],[45,4,34,2],[45,5,34,3],[45,6,34,4],[45,12,34,10],[46,6,35,4],[47,4,35,4],[48,2,37,0],[49,2,37,1],[49,6,37,1,"_c"],[49,8,37,1],[49,10,37,1,"_c2"],[49,13,37,1],[50,2,37,1,"$RefreshReg$"],[50,14,37,1],[50,15,37,1,"_c"],[50,17,37,1],[51,2,37,1,"$RefreshReg$"],[51,14,37,1],[51,15,37,1,"_c2"],[51,18,37,1],[52,0,37,1],[52,3]],"functionMap":{"names":["<global>","KEY","META","getCachedImage","primeImages","queries.map$argument_0"],"mappings":"AAA;YCI,uCD;aEC,2CF;OGE;CHqB;OIE;kCCE,wBD"},"hasCjsExports":false},"type":"js/module"}]}